name: Update SUMMARY.md

on:
  push:
    branches:
      - main  # Cambia 'main' si usas otra rama

jobs:
  update-summary:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar el repositorio
        uses: actions/checkout@v3

      - name: Generar nuevo SUMMARY.md
        run: |
          #!/bin/bash

          SUMMARY_FILE="SUMMARY.md"
          echo "# Summary" > "$SUMMARY_FILE"
          echo "" >> "$SUMMARY_FILE"

          generate_summary() {
              local dir="$1"
              local indent="$2"

              # Obtener lista de archivos y directorios ordenados
              for entry in $(find "$dir" -mindepth 1 -maxdepth 1 \( -type d -o -type f -name "*.md" \) | sort -f); do
                  local name=$(basename "$entry")
                  
                  if [[ -d "$entry" ]]; then
                      echo "${indent}* **$name/**" >> "$SUMMARY_FILE"
                      generate_summary "$entry" "$indent  "
                  elif [[ -f "$entry" && "$name" != "SUMMARY.md" ]]; then
                      local title=$(head -n 1 "$entry" | sed 's/# //')
                      [[ -z "$title" ]] && title="${name%.md}"
                      relative_path="${entry#./}"
                      echo "${indent}* [$title]($relative_path)" >> "$SUMMARY_FILE"
                  fi
              done
          }

          generate_summary "." ""

      - name: Subir cambios si hay modificaciones
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add SUMMARY.md
          git diff --staged --quiet || (git commit -m "Actualizar SUMMARY.md" && git push)
